<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Referral Approvals - Crown Trade Academy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Luxury Header -->
    <header class="premium-header">
        <nav class="premium-nav">
            <a href="index.html" class="logo">
                <span>üëë</span>
                Crown Trade Academy
            </a>
            <div style="display: flex; align-items: center; gap: 2rem;">
                <span style="color: var(--gold-accent); font-weight: 600;">Referral Approvals</span>
                <ul class="nav-links">
                    <li><a href="admin-dashboard.html">Dashboard</a></li>
                    <li><a href="admin-referral-approvals.html" style="color: var(--gold-accent);">Referral Approvals</a></li>
                    <li><a href="admin-withdrawal-approvals.html">Withdrawal Approvals</a></li>
                    <li><span class="admin-badge-luxury" id="adminName">Administrator</span></li>
                    <li><a href="#" onclick="logoutAdmin()" style="color: var(--warm-beige);"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Luxury Hero -->
    <section class="premium-container" style="padding: 2rem 0;">
        <div class="luxury-card" style="background: linear-gradient(135deg, var(--muted-rose), var(--warm-beige)); color: var(--dark-brown);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 2rem;">
                <div>
                    <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-user-check"></i> Referral Program Approvals
                    </h1>
                    <p style="font-size: 1.1rem; font-weight: 600;">Review and approve referral program applications</p>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 0.9rem; color: var(--dark-brown);">Pending Applications</div>
                    <div style="font-size: 2rem; font-weight: 700;" id="pendingCount">0</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Pending Applications -->
    <section class="premium-container">
        <div class="luxury-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: var(--dark-brown); font-size: 1.8rem;">
                    <i class="fas fa-clock"></i> Pending Applications
                </h2>
                <div style="display: flex; gap: 1rem;">
                    <button class="luxury-btn" onclick="exportApprovals()">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <button class="luxury-btn" onclick="refreshApplications()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div id="applicationsList">
                <!-- Applications will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Approval Modal -->
    <div id="approvalModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 1.5rem; color: var(--dark-brown); font-size: 1.8rem;">
                <i class="fas fa-user-check"></i> Review Application
            </h2>
            
            <div id="applicationDetails">
                <!-- Application details loaded here -->
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 2rem;">
                <button class="luxury-btn btn-success" onclick="approveApplication()">
                    <i class="fas fa-check"></i> Approve Application
                </button>
                <button class="luxury-btn btn-danger" onclick="rejectApplication()">
                    <i class="fas fa-times"></i> Reject Application
                </button>
            </div>
            
            <button class="luxury-btn" onclick="closeModal('approvalModal')" style="margin-top: 1rem; width: 100%; background: linear-gradient(135deg, #95A5A6, #7F8C8D);">
                <i class="fas fa-arrow-left"></i> Back to List
            </button>
        </div>
    </div>

    <script>
        // Admin authentication
        if (localStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'admin-login.html';
        }

        let currentApplicationId = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadPendingApplications();
        });

        function loadPendingApplications() {
            const pendingApplications = JSON.parse(localStorage.getItem('pendingReferralApplications') || '[]');
            const applicationsList = document.getElementById('applicationsList');
            document.getElementById('pendingCount').textContent = pendingApplications.length;

            if (pendingApplications.length === 0) {
                applicationsList.innerHTML = `
                    <div style="text-align: center; padding: 4rem; color: var(--muted-rose);">
                        <div style="font-size: 5rem; margin-bottom: 1rem;">üéâ</div>
                        <h3 style="color: var(--dark-brown); margin-bottom: 1rem;">No Pending Applications</h3>
                        <p>All referral applications have been processed successfully.</p>
                    </div>
                `;
                return;
            }

            applicationsList.innerHTML = pendingApplications.map(app => `
                <div class="application-card" onclick="viewApplication('${app.id}')">
                    <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 1rem;">
                        <div>
                            <h3 style="color: var(--dark-brown); margin-bottom: 0.5rem;">${app.userData.fullName}</h3>
                            <p style="color: var(--muted-rose); margin: 0;">${app.userData.email} ‚Ä¢ ${app.userData.phone}</p>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.2rem; font-weight: 700; color: var(--dark-brown);">KES 500</div>
                            <div style="color: var(--muted-rose); font-size: 0.9rem;">${new Date(app.submissionDate).toLocaleDateString()}</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <span class="status-badge status-pending">Pending Review</span>
                        <button class="luxury-btn btn-success" onclick="event.stopPropagation(); approveApplication('${app.id}')" style="padding: 0.5rem 1rem;">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="luxury-btn btn-danger" onclick="event.stopPropagation(); rejectApplication('${app.id}')" style="padding: 0.5rem 1rem;">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function approveApplication(appId) {
            const pendingApplications = JSON.parse(localStorage.getItem('pendingReferralApplications') || '[]');
            const application = pendingApplications.find(app => app.id === appId);
            
            if (!application) return;

            // Create approved user
            const approvedUser = {
                id: 'user_' + Date.now(),
                fullName: application.userData.fullName,
                email: application.userData.email,
                phone: application.userData.phone,
                password: application.userData.password,
                package: 'referral-only',
                status: 'active',
                registrationDate: new Date().toISOString(),
                approvedDate: new Date().toISOString(),
                approvedBy: localStorage.getItem('adminName') || 'Admin'
            };

            // Save to users
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            users.push(approvedUser);
            localStorage.setItem('users', JSON.stringify(users));

            // Initialize referral data
            const referralData = JSON.parse(localStorage.getItem('referralData') || '{}');
            referralData[application.userData.email] = {
                totalEarnings: 0,
                totalReferrals: 0,
                successfulReferrals: 0,
                pendingEarnings: 0,
                referralHistory: [],
                joinDate: new Date().toISOString()
            };
            localStorage.setItem('referralData', JSON.stringify(referralData));

            // Remove from pending
            const updatedApplications = pendingApplications.filter(app => app.id !== appId);
            localStorage.setItem('pendingReferralApplications', JSON.stringify(updatedApplications));

            alert(`‚úÖ Application approved! ${application.userData.fullName} can now access their referral dashboard.`);
            loadPendingApplications();
        }

        function rejectApplication(appId) {
            if (confirm('Are you sure you want to reject this application?')) {
                const pendingApplications = JSON.parse(localStorage.getItem('pendingReferralApplications') || '[]');
                const updatedApplications = pendingApplications.filter(app => app.id !== appId);
                localStorage.setItem('pendingReferralApplications', JSON.stringify(updatedApplications));
                
                alert('‚ùå Application rejected and removed from the system.');
                loadPendingApplications();
            }
        }

        function refreshApplications() {
            loadPendingApplications();
            alert('Applications list refreshed!');
        }

        function logoutAdmin() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminRole');
            localStorage.removeItem('adminName');
            window.location.href = 'admin-login.html';
        }
    </script>
</body>
                        </html>
