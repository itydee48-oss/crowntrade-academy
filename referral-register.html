<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apply - Crown Trade Academy</title>
<link rel="stylesheet" href="style.css">
<style>
  /* Minimal styles for referral register page */
  body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; }
  .premium-header { background:#3a2d28; padding:1rem; }
  .premium-header .premium-nav { display:flex; justify-content:space-between; align-items:center; }
  .premium-header .premium-nav a.logo { color:#d4af37; font-weight:bold; text-decoration:none; font-size:1.2rem; }
  .premium-container { max-width:600px; margin:3rem auto; padding:2rem; background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
  .form-group { margin-bottom:1.5rem; }
  .form-label { display:block; margin-bottom:0.5rem; color:#3a2d28; font-weight:bold; }
  .form-control { width:100%; padding:0.6rem 1rem; border-radius:8px; border:1px solid #ccc; }
  .btn-premium { background:#3a2d28; color:#d4af37; padding:0.7rem 1.5rem; border:none; border-radius:8px; cursor:pointer; }
  .file-upload { border:2px dashed #ccc; border-radius:8px; padding:1rem; text-align:center; cursor:pointer; }
  .file-upload.dragover { border-color:#d4af37; background:rgba(212,175,55,0.1); }
  .file-preview img { max-width:200px; max-height:150px; border-radius:8px; margin-bottom:1rem; }
</style>
</head>
<body>

<header class="premium-header">
  <nav class="premium-nav">
    <a href="referral-register.html" class="logo">Crown Trade Academy</a>
  </nav>
</header>

<section class="premium-container">
  <h1 style="text-align:center; color:#3a2d28;">Referral Program Application</h1>

  <form id="applicationForm">
    <div class="form-group">
      <label class="form-label">Full Name *</label>
      <input type="text" id="fullName" class="form-control" required>
    </div>
    <div class="form-group">
      <label class="form-label">Email *</label>
      <input type="email" id="email" class="form-control" required>
    </div>
    <div class="form-group">
      <label class="form-label">Phone Number *</label>
      <input type="tel" id="phone" class="form-control" required>
    </div>

    <!-- Payment Screenshot -->
    <div class="form-group">
      <label class="form-label">Payment Screenshot *</label>
      <div class="file-upload" id="fileUploadArea">
        <input type="file" id="paymentProof" accept="image/*" style="display:none;" onchange="handleFileSelect(event)">
        <p>Click or drag and drop an image</p>
      </div>
      <div class="file-preview" id="filePreview" style="display:none;">
        <img id="previewImage" src="">
        <button type="button" onclick="changeFile()">Change File</button>
      </div>
    </div>

    <div class="form-group">
      <label><input type="checkbox" id="termsAgreement"> I agree to the Terms and Conditions</label>
    </div>

    <button type="button" class="btn-premium" onclick="submitApplication()">Submit Application</button>
  </form>
</section>

<script>
let applicationData = { fullName:'', email:'', phone:'', proofBase64:'', referralCode:'' };

// Detect referral code from URL query
const urlParams = new URLSearchParams(window.location.search);
const refEmail = urlParams.get('ref');
if(refEmail) applicationData.referralCode = refEmail;

// File upload handling
document.getElementById('fileUploadArea').addEventListener('click',()=>document.getElementById('paymentProof').click());
document.getElementById('fileUploadArea').addEventListener('dragover', e=>{e.preventDefault(); e.currentTarget.classList.add('dragover');});
document.getElementById('fileUploadArea').addEventListener('dragleave', e=>{ e.currentTarget.classList.remove('dragover'); });
document.getElementById('fileUploadArea').addEventListener('drop', e=>{ e.preventDefault(); e.currentTarget.classList.remove('dragover'); handleFileSelect({target:{files:e.dataTransfer.files}}); });

function handleFileSelect(event){
  const file = event.target.files[0];
  if(!file || !file.type.match('image.*') || file.size>5*1024*1024){ alert('Invalid file'); return; }
  const reader = new FileReader();
  reader.onload = e=>{
    applicationData.proofBase64 = e.target.result;
    document.getElementById('filePreview').style.display='block';
    document.getElementById('previewImage').src = e.target.result;
    document.getElementById('fileUploadArea').style.display='none';
  };
  reader.readAsDataURL(file);
}
function changeFile(){ document.getElementById('paymentProof').value=''; document.getElementById('filePreview').style.display='none'; document.getElementById('fileUploadArea').style.display='block'; applicationData.proofBase64=''; }

// Submit application
function submitApplication(){
  const fullName = document.getElementById('fullName').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const terms = document.getElementById('termsAgreement').checked;

  if(!fullName || !email || !phone){ alert('Fill all fields'); return; }
  if(!terms){ alert('Agree to terms'); return; }
  if(!applicationData.proofBase64){ alert('Upload payment proof'); return; }

  applicationData.fullName = fullName;
  applicationData.email = email;
  applicationData.phone = phone;

  // Save application
  const applications = JSON.parse(localStorage.getItem('referral_applications')||'[]');
  applications.push({
    id:'CTA-'+Date.now(),
    fullName:applicationData.fullName,
    email:applicationData.email,
    phone:applicationData.phone,
    proofBase64:applicationData.proofBase64,
    referralCode:applicationData.referralCode,
    status:'pending',
    submittedAt:new Date().toISOString()
  });
  localStorage.setItem('referral_applications',JSON.stringify(applications));

  // Create/update user
  const users = JSON.parse(localStorage.getItem('users')||'[]');
  const existingUserIndex = users.findIndex(u=>u.email===email);
  const user = {
    id:'USER-'+Date.now(),
    fullName,email,phone,
    referralCodeUsed:applicationData.referralCode,
    userReferralCode:'CTA-'+fullName.substring(0,3).toUpperCase()+'-'+Date.now().toString().slice(-4),
    status:'pending',
    joinedAt:new Date().toISOString(),
    approvedAt:null,
    balance:0,
    totalEarnings:0,
    pendingEarnings:0,
    referrals:[],
    applicationId:'CTA-'+Date.now()
  };
  if(existingUserIndex!==-1) users[existingUserIndex]=user; else users.push(user);
  localStorage.setItem('users',JSON.stringify(users));
  localStorage.setItem('current_user_email',email);

  alert('Application submitted! Waiting for admin approval.');
  window.location.href='referral-pending.html';
}
</script>

</body>
</html>
