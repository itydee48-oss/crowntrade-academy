<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Apply - Crown Trade Academy</title>
  <link rel="stylesheet" href="style.css">
  <style>
    :root{
      --dark-brown:#3A2D28; --muted-rose:#A48374; --warm-beige:#CBAD8D;
      --light-taupe:#D1C7BD; --off-white:#EBE3DB; --cream-white:#F1EDE6;
      --gold-accent:#D4AF37;
    }
    /* Loader CSS (fullscreen gradient + gold spinner) */
    #loader-overlay{position:fixed;inset:0;background:linear-gradient(135deg,#000000 40%,#b8860b 100%);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;transition:opacity .8s ease,visibility .8s ease;visibility:visible;opacity:1;}
    #loader-spinner{width:90px;height:90px;border:4px solid rgba(255,215,0,0.3);border-top-color:#ffd700;border-radius:50%;animation:spin 1s linear infinite;box-shadow:0 0 25px 5px rgba(255,215,0,0.3);}
    #loader-text{margin-top:18px;font-family:Segoe UI,Segoe,Arial,sans-serif;font-size:1.05rem;color:#ffd700;text-transform:uppercase;letter-spacing:1px;opacity:.95}
    @keyframes spin{100%{transform:rotate(360deg)}}
    body.loaded #loader-overlay{opacity:0;visibility:hidden}

    /* Page minimal styles */
    body{font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; background:linear-gradient(135deg,var(--off-white),var(--cream-white)); color:var(--dark-brown);}
    .premium-header{background:linear-gradient(135deg,var(--dark-brown),#2A1F1A); color:var(--cream-white); padding:1rem 2rem; display:flex; align-items:center; justify-content:space-between; border-bottom:3px solid var(--gold-accent);}
    .logo{font-weight:700; color:var(--warm-beige); text-decoration:none;}
    .premium-container{max-width:880px;margin:2rem auto;padding:0 20px;}
    .premium-card{background:linear-gradient(135deg,var(--cream-white),#fff); border-radius:16px; padding:2rem; box-shadow:0 12px 40px rgba(58,45,40,0.06); border:1px solid var(--light-taupe);}
    .form-group{margin-bottom:1rem;}
    label{display:block;margin-bottom:.4rem;color:var(--muted-rose);}
    input.form-control, textarea.form-control{width:100%;padding:.8rem;border:1px solid var(--light-taupe);border-radius:8px; font-size:1rem;}
    .btn-premium{background:linear-gradient(135deg,var(--dark-brown),#4A3A32);color:var(--cream-white);padding:.9rem 1.2rem;border-radius:10px;border:none;cursor:pointer;font-weight:700;transition:box-shadow .25s, transform .12s;}
    .btn-premium:hover{box-shadow:0 8px 30px rgba(212,175,55,0.16); transform:translateY(-3px)}
    .btn-secondary{background:transparent;border:1px solid var(--gold-accent);color:var(--dark-brown);padding:.6rem 1rem;border-radius:8px;cursor:pointer;}
    .step-indicator{display:flex;justify-content:space-between;margin-bottom:1.5rem;position:relative;padding:0 1rem;}
    .step-indicator::before{content:'';position:absolute;left:0;right:0;top:14px;height:2px;background:var(--light-taupe);z-index:1}
    .step{background:var(--off-white);border:2px solid var(--light-taupe);width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;z-index:2}
    .step.active{background:var(--gold-accent);border-color:var(--gold-accent);color:var(--dark-brown)}
    .file-upload{border:2px dashed var(--light-taupe);border-radius:10px;padding:1.6rem;text-align:center;cursor:pointer;transition:all .18s}
    .file-upload.dragover{border-color:var(--gold-accent);background:rgba(212,175,55,0.05)}
    .file-preview img{max-width:200px;border-radius:8px;box-shadow:0 8px 20px rgba(0,0,0,0.08)}
    .payment-notice{background:linear-gradient(135deg,var(--off-white),#fff);border:1px solid var(--light-taupe);padding:1rem;border-radius:10px;margin-bottom:1rem;}
    .summary-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    @media(max-width:700px){ .summary-grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <!-- Loader -->
  <div id="loader-overlay">
    <div id="loader-spinner"></div>
    <div id="loader-text">Crown Trade Loading...</div>
  </div>

  <header class="premium-header">
    <a class="logo" href="index.html">Crown Trade Academy</a>
  </header>

  <main class="premium-container">
    <div class="premium-card">
      <h1 style="text-align:center;margin-bottom:6px;color:var(--dark-brown)">Apply for Referral Program</h1>
      <p style="text-align:center;color:var(--muted-rose);margin-bottom:1.25rem">Complete your application in simple steps</p>

      <!-- Step indicator -->
      <div class="step-indicator">
        <div class="step active">1</div>
        <div class="step">2</div>
        <div class="step">3</div>
      </div>

      <!-- Step 1: Personal -->
      <div id="step1" class="step-content active">
        <form id="applicationForm" onsubmit="event.preventDefault(); validateStep1();">
          <div class="form-group">
            <label>Full Name *</label>
            <input id="fullName" class="form-control" required placeholder="Your full name">
          </div>
          <div class="form-group">
            <label>Email Address *</label>
            <input id="email" class="form-control" type="email" required placeholder="you@example.com">
          </div>
          <div class="form-group">
            <label>Phone Number *</label>
            <input id="phone" class="form-control" required placeholder="07XXXXXXXX">
          </div>
          <div class="form-group">
            <label>Referral (optional)</label>
            <input id="referralCode" class="form-control" placeholder="If you have a referrer id">
          </div>
          <div style="display:flex;gap:.6rem;justify-content:flex-end;">
            <button type="button" class="btn-premium" onclick="validateStep1()">Continue to Payment</button>
          </div>
        </form>
      </div>

      <!-- Step 2: Payment -->
      <div id="step2" class="step-content" style="display:none;margin-top:1rem;">
        <h3 style="margin-bottom:.6rem;color:var(--dark-brown)">Payment & Proof</h3>
        <div class="payment-notice">
          <p style="margin:0 0 .6rem 0;color:var(--dark-brown)"><strong>Send KES 500</strong> to Till: <strong>123456</strong> ‚Äî use your full name as reference.</p>
          <p style="margin:0;color:var(--muted-rose)">Upload the payment screenshot below (PNG / JPG, max 5MB).</p>
        </div>

        <div class="form-group">
          <label>Upload Payment Proof *</label>
          <div id="fileUploadArea" class="file-upload" onclick="document.getElementById('paymentProof').click()">
            <input id="paymentProof" type="file" accept="image/*" style="display:none" onchange="handleFileSelect(event)">
            <div id="fileUploadContent">
              <p style="margin:0;color:var(--muted-rose)">üìÅ Click or drop file here</p>
              <p style="margin:0;color:var(--muted-rose);font-size:.9rem">PNG, JPG ‚Äî up to 5MB</p>
            </div>
            <div id="filePreview" style="display:none;margin-top:.8rem" class="file-preview">
              <img id="previewImage" src="" alt="preview">
              <div style="margin-top:.6rem"><button class="btn-secondary" type="button" onclick="changeFile()">Change file</button></div>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:.6rem;justify-content:space-between;margin-top:1rem;">
          <button class="btn-secondary" onclick="prevStep(1)">Back</button>
          <button class="btn-premium" onclick="validateStep2()">Continue to Review</button>
        </div>
      </div>

      <!-- Step 3: Review -->
      <div id="step3" class="step-content" style="display:none;margin-top:1rem;">
        <h3 style="margin-bottom:.6rem;color:var(--dark-brown)">Review & Submit</h3>
        <div style="background:var(--off-white);padding:1rem;border-radius:8px;margin-bottom:1rem;">
          <div class="summary-grid">
            <div>
              <div style="color:var(--muted-rose);font-size:.9rem">Name</div>
              <div id="summaryName" style="font-weight:700;color:var(--dark-brown)">-</div>
            </div>
            <div>
              <div style="color:var(--muted-rose);font-size:.9rem">Email</div>
              <div id="summaryEmail" style="font-weight:700;color:var(--dark-brown)">-</div>
            </div>
            <div>
              <div style="color:var(--muted-rose);font-size:.9rem">Phone</div>
              <div id="summaryPhone" style="font-weight:700;color:var(--dark-brown)">-</div>
            </div>
            <div>
              <div style="color:var(--muted-rose);font-size:.9rem">Referral</div>
              <div id="summaryReferral" style="font-weight:700;color:var(--dark-brown)">-</div>
            </div>
            <div style="grid-column:1 / -1;">
              <div style="color:var(--muted-rose);font-size:.9rem">Payment Proof</div>
              <div id="paymentProofStatus" style="margin-top:.4rem;color:#dc3545">‚ùå Not uploaded</div>
            </div>
          </div>
        </div>

        <label style="display:flex;gap:.6rem;align-items:flex-start;padding:1rem;background:var(--off-white);border-radius:8px;">
          <input id="termsAgreement" type="checkbox" style="margin-top:.4rem">
          <div style="color:var(--muted-rose)"><strong style="color:var(--dark-brown)">I confirm the information is accurate</strong><br>Application will be reviewed in 24-48 hours.</div>
        </label>

        <div style="display:flex;gap:.6rem;margin-top:1rem;">
          <button class="btn-secondary" onclick="prevStep(2)">‚Üê Back to Payment</button>
          <button class="btn-premium" id="submitButton" onclick="submitApplication()">üöÄ Submit Application</button>
        </div>
      </div>

    </div>
  </main>

  <!-- script.js will provide functions used here -->
  <script src="script.js"></script>
  <script>
    // Local helpers specific to this file: uses global functions defined in script.js
    // Validate Step 1
    function validateStep1(){
      const full = document.getElementById('fullName').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      if(!full){ alert('Enter full name'); document.getElementById('fullName').focus(); return; }
      if(!email){ alert('Enter email'); document.getElementById('email').focus(); return; }
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if(!re.test(email)){ alert('Enter valid email'); document.getElementById('email').focus(); return; }
      if(!phone){ alert('Enter phone'); document.getElementById('phone').focus(); return; }
      // Save to MultiApp
      MultiApp.data.fullName = full;
      MultiApp.data.email = email;
      MultiApp.data.phone = phone;
      MultiApp.data.referralCode = document.getElementById('referralCode').value.trim() || null;
      // move to step2
      document.getElementById('step1').style.display='none';
      document.getElementById('step2').style.display='block';
      document.querySelectorAll('.step')[0].classList.remove('active');
      document.querySelectorAll('.step')[1].classList.add('active');
    }

    function handleFileSelect(e){
      const files = e.target.files;
      if(files && files[0]) {
        const file = files[0];
        if(!file.type.match('image.*')) return alert('Select an image');
        if(file.size > 5*1024*1024) return alert('File too large (max 5MB)');
        const reader = new FileReader();
        reader.onload = function(evt){
          MultiApp.data.proofBase64 = evt.target.result;
          document.getElementById('fileUploadContent').style.display='none';
          document.getElementById('filePreview').style.display='block';
          document.getElementById('previewImage').src = evt.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    function changeFile(){
      document.getElementById('paymentProof').value = '';
      MultiApp.data.proofBase64 = '';
      document.getElementById('filePreview').style.display='none';
      document.getElementById('fileUploadContent').style.display='block';
    }

    function validateStep2(){
      if(!MultiApp.data.proofBase64){ alert('Please upload payment proof'); return; }
      // go to review
      document.getElementById('step2').style.display='none';
      document.getElementById('step3').style.display='block';
      document.querySelectorAll('.step')[1].classList.remove('active');
      document.querySelectorAll('.step')[2].classList.add('active');
      updateApplicationSummary();
    }

    function prevStep(step){
      // step param is number to show
      const cur = document.querySelectorAll('.step-content');
      cur.forEach(c => c.style.display='none');
      document.getElementById('step'+step).style.display='block';
      // update step markers
      document.querySelectorAll('.step').forEach((s,i)=> s.classList.toggle('active', i===step-1));
    }

    function updateApplicationSummary(){
      document.getElementById('summaryName').textContent = MultiApp.data.fullName || '-';
      document.getElementById('summaryEmail').textContent = MultiApp.data.email || '-';
      document.getElementById('summaryPhone').textContent = MultiApp.data.phone || '-';
      document.getElementById('summaryReferral').textContent = (getTempReferrer() || MultiApp.data.referralCode) || 'None';
      const statusEl = document.getElementById('paymentProofStatus');
      if(MultiApp.data.proofBase64){
        statusEl.innerHTML = `<span style="color:#28a745">‚úÖ Uploaded</span> <button class="btn-secondary" onclick="viewPaymentProof()">View</button>`;
      } else {
        statusEl.textContent = '‚ùå Not uploaded';
      }
    }

    function submitApplication(){
      if(!document.getElementById('termsAgreement').checked) { alert('Agree to terms'); return; }
      // copy MultiApp values into the form submission handler in script.js
      // re-use submitReferralApplicationFromForm wrapper (script.js)
      // But copy data from MultiApp to DOM-required ids (script.js expects to read inputs but also uses MultiApp)
      // We'll just call submitReferralApplicationFromForm which references MultiApp.data
      submitReferralApplicationFromForm();
    }
  </script>
</body>
</html>
