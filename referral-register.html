<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Apply - Crown Trade Academy</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Stepper & Form Styles */
    .step-indicator { display:flex; justify-content:space-between; margin-bottom:2rem; position:relative; }
    .step-indicator::before { content:''; position:absolute; top:15px; left:0; right:0; height:2px; background:#ccc; z-index:1; }
    .step { background:#fff; border:2px solid #ccc; border-radius:50%; width:30px; height:30px; display:flex; align-items:center; justify-content:center; font-weight:600; position:relative; z-index:2; }
    .step.active { background:#d4af37; border-color:#d4af37; color:#333; }
    .step.completed { background:#e08c7d; border-color:#e08c7d; color:white; }
    .step-content { display:none; }
    .step-content.active { display:block; }
    .file-upload { border:2px dashed #ccc; border-radius:8px; padding:2rem; text-align:center; cursor:pointer; transition:all 0.3s ease; }
    .file-upload:hover { border-color:#d4af37; }
    .file-upload.dragover { border-color:#d4af37; background:rgba(212,175,55,0.1); }
    .summary-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    .summary-item { margin-bottom:1rem; }
    .summary-label { color:#e08c7d; font-size:0.9rem; margin-bottom:0.25rem; }
    .summary-value { color:#333; font-weight:600; }
    #successModal { animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
  </style>
</head>
<body>
<header class="premium-header">
  <nav class="premium-nav">
    <a href="index.html" class="logo">Crown Trade Academy</a>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="mentorship-form.html">Mentorship</a></li>
      <li><a href="referral-register.html">Referral Program</a></li>
      <li><a href="login.html">Client Login</a></li>
      <li><a href="admin-login.html">Admin Login</a></li>
    </ul>
  </nav>
</header>

<section class="premium-container" style="padding:2rem 0;">
  <div class="premium-card">
    <h1 style="text-align:center; color:#333;">Apply for Referral Program</h1>
    <p style="text-align:center; color:#e08c7d; margin-bottom:2rem;">Complete your application in 3 steps</p>

    <!-- Step Indicator -->
    <div class="step-indicator">
      <div class="step active">1</div>
      <div class="step">2</div>
      <div class="step">3</div>
    </div>

    <!-- Step 1 -->
    <div id="step1" class="step-content active">
      <h3>Personal Information</h3>
      <form id="applicationForm">
        <div class="form-group">
          <label>Full Name *</label>
          <input type="text" id="fullName" required placeholder="Enter your full name">
        </div>
        <div class="form-group">
          <label>Email Address *</label>
          <input type="email" id="email" required placeholder="Enter your email">
        </div>
        <div class="form-group">
          <label>Phone Number *</label>
          <input type="tel" id="phone" required placeholder="Enter your phone">
        </div>
        <div class="form-group">
          <label>Referral Code (Optional)</label>
          <input type="text" id="referralCode" placeholder="Enter referral code">
        </div>
        <button type="button" class="btn-premium" onclick="validateStep1()">Continue to Payment</button>
      </form>
    </div>

    <!-- Step 2 -->
    <div id="step2" class="step-content">
      <h3>Payment Details</h3>
      <p>üí∞ Send <strong>KES 500</strong> to Till Number <strong>123456</strong> using your full name as reference. Upload the screenshot below.</p>
      <div class="form-group">
        <label>Upload Payment Proof *</label>
        <div class="file-upload" id="fileUploadArea" onclick="document.getElementById('paymentProof').click()">
          <input type="file" id="paymentProof" accept="image/*" style="display:none;" onchange="handleFileSelect(event)">
          <div id="fileUploadContent">
            <p>üìÅ Click to upload or drag & drop</p>
            <p>PNG, JPG up to 5MB</p>
          </div>
          <div id="filePreview" style="display:none;">
            <img id="previewImage" src="" style="max-width:200px; max-height:150px; border-radius:8px; margin-bottom:1rem;">
            <p>‚úÖ File selected</p>
            <button type="button" class="btn-secondary" onclick="changeFile()">Change File</button>
          </div>
        </div>
      </div>
      <div style="display:flex; gap:1rem;">
        <button type="button" class="btn-secondary" onclick="prevStep(1)">Back</button>
        <button type="button" class="btn-premium" onclick="validateStep2()">Continue to Review</button>
      </div>
    </div>

    <!-- Step 3 -->
    <div id="step3" class="step-content">
      <h3>Review & Submit</h3>
      <div style="background:#fff; padding:1.5rem; border-radius:12px; margin-bottom:1.5rem;">
        <h4>Application Summary</h4>
        <div id="applicationSummary" class="summary-grid">
          <div class="summary-item"><div class="summary-label">Name:</div><div class="summary-value" id="summaryName">-</div></div>
          <div class="summary-item"><div class="summary-label">Email:</div><div class="summary-value" id="summaryEmail">-</div></div>
          <div class="summary-item"><div class="summary-label">Phone:</div><div class="summary-value" id="summaryPhone">-</div></div>
          <div class="summary-item"><div class="summary-label">Referral Code:</div><div class="summary-value" id="summaryReferral">-</div></div>
          <div class="summary-item" style="grid-column:1/-1;">
            <div class="summary-label">Payment Proof:</div>
            <div id="paymentProofStatus"><span style="color:#dc3545;">‚ùå Not uploaded</span></div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" id="termsAgreement">
          <span>I agree to the Terms and Conditions</span>
        </label>
      </div>

      <div style="display:flex; gap:1rem; margin-top:2rem;">
        <button type="button" class="btn-secondary" style="flex:1;" onclick="prevStep(2)">‚Üê Back</button>
        <button type="button" class="btn-premium" style="flex:1;" onclick="submitApplication()">üöÄ Submit Application</button>
      </div>

      <!-- Success Modal -->
      <div id="successModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; align-items:center; justify-content:center;">
        <div class="premium-card" style="max-width:400px; text-align:center;">
          <div style="font-size:3rem; margin-bottom:1rem;">‚úÖ</div>
          <h3>Application Submitted!</h3>
          <p>Your application is under review. Redirecting...</p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
let currentStep = 1;
let applicationData = { fullName:'', email:'', phone:'', referralCode:'', proofBase64:'' };

function nextStep(step){
  document.getElementById(`step${currentStep}`).classList.remove('active');
  document.querySelectorAll('.step')[currentStep-1].classList.remove('active');
  document.getElementById(`step${step}`).classList.add('active');
  document.querySelectorAll('.step')[step-1].classList.add('active');
  for(let i=0;i<step-1;i++){document.querySelectorAll('.step')[i].classList.add('completed');}
  currentStep=step;
  if(step===3){updateApplicationSummary();}
}

function prevStep(step){
  document.getElementById(`step${currentStep}`).classList.remove('active');
  document.querySelectorAll('.step')[currentStep-1].classList.remove('active');
  document.getElementById(`step${step}`).classList.add('active');
  document.querySelectorAll('.step')[step-1].classList.add('active');
  currentStep=step;
}

function validateStep1(){
  const fullName=document.getElementById('fullName').value.trim();
  const email=document.getElementById('email').value.trim();
  const phone=document.getElementById('phone').value.trim();
  if(!fullName){alert('Enter full name'); return;}
  if(!email){alert('Enter email'); return;}
  const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if(!emailRegex.test(email)){alert('Enter valid email'); return;}
  if(!phone){alert('Enter phone'); return;}
  applicationData.fullName=fullName;
  applicationData.email=email;
  applicationData.phone=phone;
  applicationData.referralCode=document.getElementById('referralCode').value.trim();
  nextStep(2);
}

function validateStep2(){
  if(!applicationData.proofBase64){alert('Upload payment proof'); return;}
  nextStep(3);
}

function handleFileSelect(event){
  const file=event.target.files[0];
  if(!file) return;
  if(!file.type.match('image.*')){alert('Select an image'); return;}
  if(file.size>5*1024*1024){alert('Max 5MB'); return;}
  const reader=new FileReader();
  reader.onload=function(e){
    applicationData.proofBase64=e.target.result;
    document.getElementById('fileUploadContent').style.display='none';
    document.getElementById('filePreview').style.display='block';
    document.getElementById('previewImage').src=e.target.result;
  };
  reader.readAsDataURL(file);
}

function changeFile(){
  document.getElementById('paymentProof').value='';
  document.getElementById('fileUploadContent').style.display='block';
  document.getElementById('filePreview').style.display='none';
  applicationData.proofBase64='';
}

function updateApplicationSummary(){
  document.getElementById('summaryName').textContent=applicationData.fullName||'-';
  document.getElementById('summaryEmail').textContent=applicationData.email||'-';
  document.getElementById('summaryPhone').textContent=applicationData.phone||'-';
  document.getElementById('summaryReferral').textContent=applicationData.referralCode||'None';
  const proofStatus=document.getElementById('paymentProofStatus');
  proofStatus.innerHTML=applicationData.proofBase64 ? '<span style="color:#28a745;">‚úÖ Uploaded</span>' : '<span style="color:#dc3545;">‚ùå Not uploaded</span>';
}

function submitApplication(){
  if(!document.getElementById('termsAgreement').checked){alert('Agree to terms'); return;}
  const applications=JSON.parse(localStorage.getItem('referral_applications')||'[]');
  const newApp={...applicationData, status:'pending', submittedAt:new Date().toISOString()};
  applications.push(newApp);
  localStorage.setItem('referral_applications',JSON.stringify(applications));
  document.getElementById('successModal').style.display='flex';
  setTimeout(()=>{window.location.href='referral-pending.html';},1500);
}
</script>
</body>
</html>
