<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply for Referral Program - Crown Trade Academy</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Premium Header -->
    <header class="premium-header">
        <nav class="premium-nav">
            <a href="index.html" class="logo">Crown Trade Academy</a>
        </nav>
    </header>

    <section class="premium-container" style="padding: 2rem 0;">
        <div class="premium-card">
            <h1 style="text-align: center; color: var(--dark-brown); margin-bottom: 1rem;">Apply for Referral Program</h1>
            <p style="text-align: center; color: var(--muted-rose); margin-bottom: 2rem;">Join our referral program and start earning today</p>

            <!-- Application Form -->
            <form id="referralForm">
                <div class="form-group">
                    <label class="form-label">Full Name *</label>
                    <input type="text" id="fullName" class="form-control" required placeholder="Enter your full name">
                </div>

                <div class="form-group">
                    <label class="form-label">Email Address *</label>
                    <input type="email" id="email" class="form-control" required placeholder="Enter your email address">
                </div>

                <div class="form-group">
                    <label class="form-label">Phone Number *</label>
                    <input type="tel" id="phone" class="form-control" required placeholder="Enter your phone number">
                </div>

                <div class="form-group">
                    <label class="form-label">Referral Code (Optional)</label>
                    <input type="text" id="referralCode" class="form-control" placeholder="Enter referral code if any">
                </div>

                <div class="payment-notice">
                    <h4 style="color: var(--dark-brown); margin-bottom: 1rem;">ðŸ’° Payment Instructions</h4>
                    <p style="color: var(--dark-brown); margin-bottom: 0.5rem;">1. Send <strong>KES 500</strong> to Till Number: <strong>123456</strong></p>
                    <p style="color: var(--dark-brown); margin-bottom: 0.5rem;">2. Use your <strong>full name</strong> as the reference</p>
                    <p style="color: var(--dark-brown); margin-bottom: 0;">3. Upload the payment screenshot below</p>
                </div>

                <div class="form-group">
                    <label class="form-label">Upload Payment Proof (Screenshot) *</label>
                    <input type="file" id="paymentProof" class="form-control" accept="image/*" required>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="termsAgreement" style="margin-right: 10px;">
                        <span style="color: var(--muted-rose);">I agree to the <a href="#" style="color: var(--gold-accent);">Terms and Conditions</a></span>
                    </label>
                </div>

                <button type="button" class="btn-premium" onclick="submitApplication()" style="width: 100%;">
                    Submit Application
                </button>
            </form>
        </div>
    </section>

    <script>
        function submitApplication() {
            console.log('Submit function called');
            
            // Get form values
            const fullName = document.getElementById('fullName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const referralCode = document.getElementById('referralCode').value.trim();
            const paymentProof = document.getElementById('paymentProof').files[0];
            const termsAgreed = document.getElementById('termsAgreement').checked;

            // Validation
            if (!fullName || !email || !phone) {
                alert('Please fill in all required fields');
                return;
            }

            if (!paymentProof) {
                alert('Please upload your payment proof screenshot');
                return;
            }

            if (!termsAgreed) {
                alert('Please agree to the Terms and Conditions');
                return;
            }

            // Convert image to base64
            const reader = new FileReader();
            reader.onload = function(e) {
                // Create application object
                const application = {
                    id: 'CTA-' + Date.now(),
                    fullName: fullName,
                    email: email,
                    phone: phone,
                    referralCode: referralCode,
                    proofBase64: e.target.result,
                    status: 'pending',
                    submittedAt: new Date().toISOString(),
                    reviewedAt: null,
                    rejectionReason: null
                };

                console.log('Application created:', application);

                // Save to localStorage
                const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');
                applications.push(application);
                localStorage.setItem('referral_applications', JSON.stringify(applications));
                console.log('Application saved to localStorage');

                // Create user account
                const user = {
                    id: 'USER-' + Date.now(),
                    fullName: fullName,
                    email: email,
                    phone: phone,
                    status: 'pending',
                    joinedAt: new Date().toISOString(),
                    approvedAt: null,
                    balance: 0,
                    totalEarnings: 0,
                    referrals: []
                };

                const users = JSON.parse(localStorage.getItem('users') || '[]');
                users.push(user);
                localStorage.setItem('users', JSON.stringify(users));
                console.log('User saved to localStorage');

                // Set current user for waiting page
                localStorage.setItem('current_user_email', email);

                // Show success message and redirect
                alert('Application submitted successfully! You will be redirected to the waiting page.');
                window.location.href = 'referral-pending.html';
            };

            reader.onerror = function(error) {
                console.error('Error reading file:', error);
                alert('Error processing your payment proof. Please try again.');
            };

            reader.readAsDataURL(paymentProof);
        }

        // Debug: Check if localStorage is working
        console.log('Current applications in localStorage:', JSON.parse(localStorage.getItem('referral_applications') || '[]'));
    </script>
</body>
</html>
