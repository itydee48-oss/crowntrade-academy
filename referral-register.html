<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apply for Referral Program - Crown Trade Academy</title>
<style>
  :root {
    --dark-brown: #3a2d28;
    --gold-accent: #d4af37;
    --muted-rose: #a67c7c;
    --soft-beige: #e8d5c4;
    --off-white: #faf8f6;
    --light-taupe: #d4c5b9;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Georgia', serif;
    background: linear-gradient(135deg, var(--off-white) 0%, var(--soft-beige) 100%);
    min-height: 100vh;
  }

  .premium-header {
    background: var(--dark-brown);
    padding: 1.5rem 2rem;
    box-shadow: 0 4px 20px rgba(58, 45, 40, 0.15);
  }

  .premium-header .premium-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
  }

  .premium-header .premium-nav a.logo {
    color: var(--gold-accent);
    font-weight: 700;
    text-decoration: none;
    font-size: 1.5rem;
    letter-spacing: 1px;
  }

  .premium-container {
    max-width: 800px;
    margin: 3rem auto;
    padding: 0 2rem 3rem 2rem;
  }

  .premium-card {
    background: linear-gradient(135deg, #fff 0%, var(--off-white) 100%);
    border-radius: 24px;
    box-shadow: 0 20px 60px rgba(58, 45, 40, 0.12);
    padding: 3rem;
    border: 1px solid rgba(212, 175, 55, 0.2);
    position: relative;
    overflow: hidden;
  }

  .premium-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--gold-accent), var(--muted-rose));
  }

  h1 {
    color: var(--dark-brown);
    text-align: center;
    margin-bottom: 0.5rem;
    font-size: 2.2rem;
    font-weight: 600;
  }

  .subtitle {
    text-align: center;
    color: var(--muted-rose);
    margin-bottom: 2.5rem;
    font-size: 1.1rem;
  }

  .step-indicator {
    display: flex;
    justify-content: space-between;
    margin-bottom: 3rem;
    position: relative;
  }

  .step-indicator::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 10%;
    right: 10%;
    height: 2px;
    background: var(--light-taupe);
    z-index: 1;
  }

  .step-wrapper {
    flex: 1;
    text-align: center;
    position: relative;
    z-index: 2;
  }

  .step {
    background: white;
    border: 3px solid var(--light-taupe);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    margin-bottom: 0.5rem;
  }

  .step.active {
    background: var(--gold-accent);
    border-color: var(--gold-accent);
    color: var(--dark-brown);
    box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
  }

  .step.completed {
    background: var(--muted-rose);
    border-color: var(--muted-rose);
    color: white;
  }

  .step-label {
    font-size: 0.85rem;
    color: var(--muted-rose);
    font-weight: 600;
  }

  .step-content {
    display: none;
  }

  .step-content.active {
    display: block;
  }

  .form-group {
    margin-bottom: 1.8rem;
  }

  .form-label {
    display: block;
    margin-bottom: 0.6rem;
    color: var(--dark-brown);
    font-weight: 600;
    font-size: 0.95rem;
  }

  .form-control {
    width: 100%;
    padding: 0.9rem 1.2rem;
    border-radius: 12px;
    border: 2px solid var(--light-taupe);
    font-size: 1rem;
    transition: all 0.3s ease;
    font-family: 'Georgia', serif;
    background: white;
  }

  .form-control:focus {
    outline: none;
    border-color: var(--gold-accent);
    box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
  }

  .payment-notice {
    background: linear-gradient(135deg, var(--soft-beige) 0%, var(--off-white) 100%);
    border-left: 4px solid var(--gold-accent);
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
  }

  .payment-notice h4 {
    color: var(--dark-brown);
    margin-bottom: 1rem;
    font-size: 1.2rem;
  }

  .payment-notice p {
    color: var(--dark-brown);
    margin: 0.5rem 0;
    line-height: 1.6;
  }

  .file-upload {
    border: 2px dashed var(--light-taupe);
    border-radius: 12px;
    padding: 2.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
  }

  .file-upload:hover {
    border-color: var(--gold-accent);
    background: rgba(212, 175, 55, 0.05);
  }

  .file-upload.dragover {
    border-color: var(--gold-accent);
    background: rgba(212, 175, 55, 0.1);
    transform: scale(1.02);
  }

  .file-preview img {
    max-width: 300px;
    max-height: 200px;
    border-radius: 12px;
    margin-bottom: 1rem;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  }

  .btn-premium {
    background: linear-gradient(135deg, var(--gold-accent) 0%, #c59d2a 100%);
    color: var(--dark-brown);
    padding: 1rem 2.5rem;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1.05rem;
    font-weight: 700;
    transition: all 0.3s ease;
    width: 100%;
    box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
  }

  .btn-premium:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(212, 175, 55, 0.4);
  }

  .btn-premium:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .btn-secondary {
    background: transparent;
    color: var(--muted-rose);
    border: 2px solid var(--muted-rose);
    padding: 1rem 2.5rem;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1.05rem;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-secondary:hover {
    background: var(--muted-rose);
    color: white;
    transform: translateY(-2px);
  }

  .button-group {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
  }

  .button-group button {
    flex: 1;
  }

  .summary-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .summary-item {
    background: var(--off-white);
    padding: 1.2rem;
    border-radius: 12px;
  }

  .summary-label {
    color: var(--muted-rose);
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 0.5rem;
  }

  .summary-value {
    color: var(--dark-brown);
    font-weight: 600;
    font-size: 1.1rem;
    word-break: break-word;
  }

  .terms-box {
    background: var(--off-white);
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
  }

  .terms-box label {
    display: flex;
    align-items: start;
    cursor: pointer;
  }

  .terms-box input[type="checkbox"] {
    margin-right: 1rem;
    margin-top: 0.3rem;
    width: 20px;
    height: 20px;
    cursor: pointer;
  }

  .spinner {
    border: 3px solid var(--light-taupe);
    border-top: 3px solid var(--gold-accent);
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    display: inline-block;
    margin-right: 10px;
    vertical-align: middle;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .success-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .success-modal.show {
    display: flex;
  }

  .success-content {
    background: white;
    padding: 3rem;
    border-radius: 24px;
    text-align: center;
    max-width: 500px;
    margin: 2rem;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  }

  .success-icon {
    font-size: 5rem;
    margin-bottom: 1.5rem;
  }

  @media (max-width: 768px) {
    .premium-card {
      padding: 2rem 1.5rem;
    }

    .summary-grid {
      grid-template-columns: 1fr;
    }

    .button-group {
      flex-direction: column;
    }

    h1 {
      font-size: 1.8rem;
    }
  }
</style>
</head>
<body>

<header class="premium-header">
  <nav class="premium-nav">
    <a href="index.html" class="logo">Crown Trade Academy</a>
  </nav>
</header>

<section class="premium-container">
  <div class="premium-card">
    <h1>Join Our Referral Program</h1>
    <p class="subtitle">Complete your application in 3 simple steps and start earning</p>

    <div class="step-indicator">
      <div class="step-wrapper">
        <div class="step active" id="stepIndicator1">1</div>
        <div class="step-label">Personal Info</div>
      </div>
      <div class="step-wrapper">
        <div class="step" id="stepIndicator2">2</div>
        <div class="step-label">Payment</div>
      </div>
      <div class="step-wrapper">
        <div class="step" id="stepIndicator3">3</div>
        <div class="step-label">Review</div>
      </div>
    </div>

    <div id="step1" class="step-content active">
      <h3 style="color:var(--dark-brown); margin-bottom:1.5rem; font-size:1.5rem;">üìã Personal Information</h3>

      <div class="form-group">
        <label class="form-label">Full Name *</label>
        <input type="text" id="fullName" class="form-control" required placeholder="Enter your full name">
      </div>

      <div class="form-group">
        <label class="form-label">Email Address *</label>
        <input type="email" id="email" class="form-control" required placeholder="your.email@example.com">
      </div>

      <div class="form-group">
        <label class="form-label">Phone Number *</label>
        <input type="tel" id="phone" class="form-control" required placeholder="+254 712 345 678">
      </div>

      <div class="form-group">
        <label class="form-label">Referral Code (Optional)</label>
        <input type="text" id="referralCode" class="form-control" placeholder="Enter referral code if you have one">
      </div>

      <button type="button" class="btn-premium" onclick="validateStep1()">
        Continue to Payment ‚Üí
      </button>
    </div>

    <div id="step2" class="step-content">
      <h3 style="color:var(--dark-brown); margin-bottom:1.5rem; font-size:1.5rem;">üí≥ Payment Details</h3>

      <div class="payment-notice">
        <h4>üí∞ Payment Instructions</h4>
        <p><strong>Amount:</strong> KES 500</p>
        <p><strong>Till Number:</strong> 123456</p>
        <p><strong>Reference:</strong> Use your full name</p>
        <p style="margin-top:1rem; font-style:italic; color:var(--muted-rose);">
          After making payment, upload a screenshot of the transaction below.
        </p>
      </div>

      <div class="form-group">
        <label class="form-label">Upload Payment Proof (Screenshot) *</label>
        <div class="file-upload" id="fileUploadArea">
          <input type="file" id="paymentProof" accept="image/*" style="display:none;">
          <div id="fileUploadContent">
            <p style="font-size:3rem; margin-bottom:1rem;">üìÅ</p>
            <p style="color:var(--muted-rose); margin-bottom:0.5rem; font-weight:600;">Click to upload or drag and drop</p>
            <p style="color:var(--muted-rose); font-size:0.9rem;">PNG, JPG, JPEG up to 5MB</p>
          </div>
          <div id="filePreview" style="display:none;">
            <img id="previewImage" src="" alt="Preview">
            <p style="color:#28a745; font-weight:600; margin-bottom:1rem;">‚úÖ Payment proof uploaded</p>
            <button type="button" class="btn-secondary" style="width:auto; padding:0.6rem 1.5rem;" onclick="changeFile()">
              Change File
            </button>
          </div>
        </div>
      </div>

      <div class="button-group">
        <button type="button" class="btn-secondary" onclick="prevStep(1)">‚Üê Back</button>
        <button type="button" class="btn-premium" onclick="validateStep2()">Continue to Review ‚Üí</button>
      </div>
    </div>

    <div id="step3" class="step-content">
      <h3 style="color:var(--dark-brown); margin-bottom:1.5rem; font-size:1.5rem;">‚úÖ Review Your Application</h3>

      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">Full Name</div>
          <div class="summary-value" id="summaryName">-</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Email Address</div>
          <div class="summary-value" id="summaryEmail">-</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Phone Number</div>
          <div class="summary-value" id="summaryPhone">-</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Referral Code</div>
          <div class="summary-value" id="summaryReferral">-</div>
        </div>
      </div>

      <div class="summary-item" style="margin-bottom:2rem;">
        <div class="summary-label">Payment Proof</div>
        <div id="paymentProofStatus" style="margin-top:0.5rem;">
          <span style="color:#dc3545;">‚ùå Not uploaded</span>
        </div>
      </div>

      <div class="terms-box">
        <label>
          <input type="checkbox" id="termsAgreement">
          <span style="color:var(--dark-brown);">
            <strong style="display:block; margin-bottom:0.5rem;">I agree to the Terms and Conditions</strong>
            <span style="font-size:0.9rem; color:var(--muted-rose);">
              I confirm that all information provided is accurate and I understand that my application will be reviewed within 24-48 hours.
            </span>
          </span>
        </label>
      </div>

      <div class="button-group">
        <button type="button" class="btn-secondary" onclick="prevStep(2)">‚Üê Back to Payment</button>
        <button type="button" class="btn-premium" id="submitButton" onclick="submitApplication()">
          <span class="spinner" id="submitSpinner" style="display:none;"></span>
          <span id="submitText">üöÄ Submit Application</span>
        </button>
      </div>
    </div>
  </div>
</section>

<div id="successModal" class="success-modal">
  <div class="success-content">
    <div class="success-icon">‚úÖ</div>
    <h2 style="color:var(--dark-brown); margin-bottom:1rem;">Application Submitted!</h2>
    <p style="color:var(--muted-rose); margin-bottom:1.5rem; line-height:1.6;">
      Your application has been received and is under review. You will be redirected to the waiting page shortly.
    </p>
    <div class="spinner" style="margin:1.5rem auto;"></div>
    <p style="color:var(--muted-rose); font-size:0.95rem;">
      Redirecting in <span id="redirectCountdown">3</span> seconds...
    </p>
    <p style="margin-top:1rem;">
      <a href="referral-pending.html" style="color:var(--gold-accent); text-decoration:underline;">
        Click here if not redirected automatically
      </a>
    </p>
  </div>
</div>

<script>
let currentStep = 1;
let applicationData = {
  fullName: '',
  email: '',
  phone: '',
  referralCode: '',
  proofBase64: ''
};

document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const refCode = urlParams.get('ref');
  if (refCode) {
    document.getElementById('referralCode').value = refCode;
  }

  const fileUploadArea = document.getElementById('fileUploadArea');
  const fileInput = document.getElementById('paymentProof');
  
  fileUploadArea.addEventListener('click', function(e) {
    if (e.target.tagName !== 'BUTTON') {
      fileInput.click();
    }
  });

  fileInput.addEventListener('change', handleFileSelect);

  fileUploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    fileUploadArea.classList.add('dragover');
  });

  fileUploadArea.addEventListener('dragleave', function() {
    fileUploadArea.classList.remove('dragover');
  });

  fileUploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    fileUploadArea.classList.remove('dragover');
    if (e.dataTransfer.files.length > 0) {
      fileInput.files = e.dataTransfer.files;
      handleFileSelect();
    }
  });
});

function nextStep(step) {
  document.getElementById('step' + currentStep).classList.remove('active');
  document.getElementById('stepIndicator' + currentStep).classList.remove('active');
  document.getElementById('stepIndicator' + currentStep).classList.add('completed');

  document.getElementById('step' + step).classList.add('active');
  document.getElementById('stepIndicator' + step).classList.add('active');

  currentStep = step;

  if (step === 3) {
    updateSummary();
  }

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function prevStep(step) {
  document.getElementById('step' + currentStep).classList.remove('active');
  document.getElementById('stepIndicator' + currentStep).classList.remove('active');

  document.getElementById('step' + step).classList.add('active');
  document.getElementById('stepIndicator' + step).classList.remove('completed');
  document.getElementById('stepIndicator' + step).classList.add('active');

  currentStep = step;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function validateStep1() {
  const fullName = document.getElementById('fullName').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();

  if (!fullName) {
    alert('Please enter your full name');
    return;
  }

  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    alert('Please enter a valid email address');
    return;
  }

  if (!phone) {
    alert('Please enter your phone number');
    return;
  }

  const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');
  if (applications.find(app => app.email === email)) {
    alert('An application with this email already exists.');
    return;
  }

  applicationData.fullName = fullName;
  applicationData.email = email;
  applicationData.phone = phone;
  applicationData.referralCode = document.getElementById('referralCode').value.trim();

  nextStep(2);
}

function validateStep2() {
  if (!applicationData.proofBase64) {
    alert('Please upload your payment proof screenshot');
    return;
  }
  nextStep(3);
}

function handleFileSelect() {
  const file = document.getElementById('paymentProof').files[0];
  if (!file) return;

  if (!file.type.match('image.*')) {
    alert('Please select an image file');
    return;
  }

  if (file.size > 5 * 1024 * 1024) {
    alert('File size must be less than 5MB');
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    applicationData.proofBase64 = e.target.result;
    document.getElementById('fileUploadContent').style.display = 'none';
    document.getElementById('filePreview').style.display = 'block';
    document.getElementById('previewImage').src = e.target.result;
  };
  reader.readAsDataURL(file);
}

function changeFile() {
  document.getElementById('paymentProof').value = '';
  document.getElementById('fileUploadContent').style.display = 'block';
  document.getElementById('filePreview').style.display = 'none';
  applicationData.proofBase64 = '';
}

function updateSummary() {
  document.getElementById('summaryName').textContent = applicationData.fullName || '-';
  document.getElementById('summaryEmail').textContent = applicationData.email || '-';
  document.getElementById('summaryPhone').textContent = applicationData.phone || '-';
  document.getElementById('summaryReferral').textContent = applicationData.referralCode || 'None';

  const status = document.getElementById('paymentProofStatus');
  if (applicationData.proofBase64) {
    status.innerHTML = '<span style="color:#28a745; font-weight:600;">‚úÖ Uploaded</span>';
  }
}

function submitApplication() {
  if (!document.getElementById('termsAgreement').checked) {
    alert('Please agree to the Terms and Conditions');
    return;
  }

  const btn = document.getElementById('submitButton');
  const spinner = document.getElementById('submitSpinner');
  const text = document.getElementById('submitText');
  
  btn.disabled = true;
  spinner.style.display = 'inline-b