<!-- Change Password Section -->
<section class="premium-card" style="margin-top:2rem; text-align:left;">
  <h3>Change Password</h3>
  <form id="changePasswordForm">
    <div class="form-group">
      <label>Current Password</label>
      <input type="password" id="currentPassword" class="form-control" required>
    </div>
    <div class="form-group">
      <label>New Password</label>
      <input type="password" id="newPassword" class="form-control" required>
    </div>
    <div class="form-group">
      <label>Confirm New Password</label>
      <input type="password" id="confirmNewPassword" class="form-control" required>
    </div>
    <button type="button" class="btn-premium" onclick="changePassword()">Update Password</button>
  </form>
  <p id="passwordMessage" style="margin-top:1rem;"></p>
</section>

<!-- Referral Info Section -->
<section class="premium-card" style="margin-top:2rem; text-align:left;">
  <h3>Your Referral Link</h3>
  <p>Share this link to earn bonuses when someone registers:</p>
  <input type="text" id="referralLink" class="form-control" readonly style="width:100%; margin-bottom:1rem;">
  <button class="btn-secondary" onclick="copyReferralLink()">Copy Link</button>
</section>

<script>
  // Set referral link
  const currentUser = JSON.parse(localStorage.getItem('users') || '[]').find(u => u.email === localStorage.getItem('current_user_email'));
  if(currentUser){
    document.getElementById('referralLink').value = `${window.location.origin}/referral-register.html?ref=${currentUser.userReferralCode}`;
  }

  function copyReferralLink(){
    const link = document.getElementById('referralLink');
    link.select();
    link.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(link.value);
    alert('Referral link copied!');
  }

  // Change password function
  function changePassword(){
    const currentPassword = document.getElementById('currentPassword').value;
    const newPassword = document.getElementById('newPassword').value;
    const confirmNewPassword = document.getElementById('confirmNewPassword').value;
    const msg = document.getElementById('passwordMessage');

    // For demo, no real current password check
    if(newPassword !== confirmNewPassword){
      msg.textContent = 'New passwords do not match.';
      msg.style.color = 'red';
      return;
    }

    // Update in localStorage
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const index = users.findIndex(u => u.email === currentUser.email);
    if(index !== -1){
      users[index].password = newPassword; // save password
      localStorage.setItem('users', JSON.stringify(users));
      msg.textContent = 'Password updated successfully!';
      msg.style.color = 'green';
      document.getElementById('changePasswordForm').reset();
    }
  }
</script>
