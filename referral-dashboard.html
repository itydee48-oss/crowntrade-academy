<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Referral Dashboard - Crown Trade Academy</title>
<link rel="stylesheet" href="style.css">
<style>
  body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; }
  .premium-header { background:#3a2d28; padding:1rem; }
  .premium-header .premium-nav { display:flex; justify-content:space-between; align-items:center; }
  .premium-header .premium-nav a.logo { color:#d4af37; font-weight:bold; text-decoration:none; font-size:1.2rem; }
  .premium-card { background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:2rem; max-width:900px; margin:3rem auto; }
  h1,h3,h4 { color:#3a2d28; }
  .summary-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-bottom:2rem; }
  .summary-item { background:#f5f5f5; padding:1rem; border-radius:8px; text-align:center; }
  .referral-list { margin-top:2rem; }
  table { width:100%; border-collapse:collapse; margin-top:1rem; }
  th,td { padding:0.8rem; text-align:left; border-bottom:1px solid #ccc; }
  th { background:#f5f5f5; }
  .status-pending { color:#ffc107; font-weight:bold; }
  .status-approved { color:#28a745; font-weight:bold; }
  .btn-copy { padding:0.4rem 0.8rem; background:#3a2d28; color:#d4af37; border:none; border-radius:6px; cursor:pointer; margin-left:0.5rem; }
</style>
</head>
<body>

<header class="premium-header">
  <nav class="premium-nav">
    <a href="referral-dashboard.html" class="logo">Referral Dashboard</a>
  </nav>
</header>

<section>
  <div class="premium-card">
    <h1>Welcome, <span id="clientName">-</span></h1>

    <div class="summary-grid">
      <div class="summary-item">
        <h4>Total Earnings</h4>
        <p>KES <span id="totalEarnings">0</span></p>
      </div>
      <div class="summary-item">
        <h4>Available Balance</h4>
        <p>KES <span id="pendingEarnings">0</span></p>
      </div>
      <div class="summary-item" style="grid-column: 1 / -1;">
        <h4>Your Referral Link</h4>
        <p><span id="referralLink">-</span> 
          <button class="btn-copy" onclick="copyReferralLink()">Copy</button>
        </p>
      </div>
    </div>

    <div class="referral-list">
      <h3>Referred Users</h3>
      <table>
        <thead>
          <tr>
            <th>Full Name</th>
            <th>Email</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="referralsTable">
          <!-- Populated dynamically -->
        </tbody>
      </table>
    </div>
  </div>
</section>

<script>
const currentUserEmail = localStorage.getItem('current_user_email');
const users = JSON.parse(localStorage.getItem('users') || '[]');
const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');

const currentUser = users.find(u=>u.email===currentUserEmail);

if(currentUser){
  document.getElementById('clientName').textContent = currentUser.fullName;
  document.getElementById('totalEarnings').textContent = currentUser.totalEarnings || 0;
  document.getElementById('pendingEarnings').textContent = currentUser.pendingEarnings || 0;

  const referralLink = `${window.location.origin}/referral-register.html?ref=${currentUser.email}`;
  document.getElementById('referralLink').textContent = referralLink;
}

// Populate referred users
const referralsTable = document.getElementById('referralsTable');
const referredUsers = applications.filter(app=>app.referralCode===currentUserEmail);
referredUsers.forEach(app=>{
  const tr = document.createElement('tr');

  const nameTd = document.createElement('td'); nameTd.textContent = app.fullName; tr.appendChild(nameTd);
  const emailTd = document.createElement('td'); emailTd.textContent = app.email; tr.appendChild(emailTd);

  const statusTd = document.createElement('td');
  statusTd.textContent = app.status;
  statusTd.className = app.status==='approved'?'status-approved':app.status==='rejected'?'status-rejected':'status-pending';
  tr.appendChild(statusTd);

  referralsTable.appendChild(tr);
});

function copyReferralLink(){
  const link = document.getElementById('referralLink').textContent;
  navigator.clipboard.writeText(link).then(()=>alert('Referral link copied!'));
}
</script>

</body>
</html>
