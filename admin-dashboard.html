<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard - Crown Trade Academy</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --dark-brown: #3A2D28;
      --muted-rose: #A48374;
      --warm-beige: #CBAD8D;
      --light-taupe: #D1C7BD;
      --off-white: #EBE3DB;
      --cream-white: #F1EDE6;
      --gold-accent: #D4AF37;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--off-white) 0%, var(--cream-white) 100%);
      color: var(--dark-brown);
      line-height:1.6;
      min-height:100vh;
    }
    .premium-header{
      background: linear-gradient(135deg, var(--dark-brown) 0%, #2A1F1A 100%);
      color: var(--cream-white);
      padding:1.2rem 0;
      box-shadow:0 4px 20px rgba(58,45,40,0.1);
      border-bottom:3px solid var(--gold-accent);
    }
    .premium-nav{ display:flex; justify-content:space-between; align-items:center; max-width:1200px; margin:0 auto; padding:0 2rem; }
    .logo{ font-size:2rem; font-weight:700; color:var(--warm-beige); text-decoration:none; }
    .nav-links{ display:flex; gap:2rem; list-style:none; align-items:center; }
    .nav-links a{ color:var(--cream-white); text-decoration:none; font-weight:500; }
    .premium-container{ max-width:1200px; margin:0 auto; padding:0 20px; }
    .premium-card{
      background: linear-gradient(135deg, var(--cream-white) 0%, #FFFFFF 100%);
      border:1px solid var(--light-taupe);
      border-radius:20px;
      padding:2.5rem;
      margin:1.5rem 0;
      position:relative;
      overflow:hidden;
      box-shadow:0 15px 40px rgba(58,45,40,0.08);
    }
    .premium-card::before{ content:''; position:absolute; top:0; left:0; right:0; height:4px;
      background: linear-gradient(90deg, var(--gold-accent), var(--warm-beige), var(--gold-accent)); }
    .btn-premium{
      background: linear-gradient(135deg, var(--dark-brown) 0%, #4A3A32 100%);
      color: var(--cream-white); border:none; padding:1rem 2rem; border-radius:12px; font-weight:700; cursor:pointer;
    }
    .btn-success {
      background: #28a745;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-danger {
      background: #dc3545;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-info {
      background: #17a2b8;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-warning {
      background: #ffc107;
      color: var(--dark-brown);
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .premium-footer{ background: linear-gradient(135deg, var(--dark-brown) 0%, #2A1F1A 100%); color: var(--cream-white); padding:3rem 0 2rem; margin-top:4rem; border-top:3px solid var(--gold-accent); }
    .footer-content{ max-width:1200px; margin:0 auto; padding:0 2rem; display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:2rem; }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    .stat-card {
      background: var(--off-white);
      border: 1px solid var(--light-taupe);
      border-radius: 15px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(139, 115, 85, 0.1);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--dark-brown);
      margin-bottom: 0.5rem;
    }
    
    .stat-label {
      color: var(--muted-rose);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    /* Application Cards */
    .application-card {
      background: var(--off-white);
      border: 1px solid var(--light-taupe);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1rem 0;
    }
    
    .action-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    
    .status-badge {
      display: inline-block;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    .status-pending { background: #ffc107; color: var(--dark-brown); }
    .status-approved { background: #28a745; color: white; }
    .status-rejected { background: #dc3545; color: white; }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid var(--light-taupe);
      flex-wrap: wrap;
    }
    
    .tab {
      padding: 1rem 2rem;
      background: none;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      color: var(--muted-rose);
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .tab.active {
      color: var(--dark-brown);
      border-bottom-color: var(--gold-accent);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Chart Container */
    .chart-container {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin: 2rem 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    /* Settings Form */
    .settings-form {
      background: var(--off-white);
      padding: 2rem;
      border-radius: 12px;
      margin: 1rem 0;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--dark-brown);
    }
    
    .form-control {
      width: 100%;
      padding: 1rem;
      border: 2px solid var(--light-taupe);
      border-radius: 8px;
      background: white;
      color: var(--dark-brown);
      font-size: 1rem;
    }
    
    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }
    
    .action-card {
      background: var(--off-white);
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
      border: 2px solid var(--light-taupe);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .action-card:hover {
      border-color: var(--gold-accent);
      transform: translateY(-2px);
    }

    /* NEW STYLES FOR MENTORSHIP MANAGEMENT */
    
    /* Mentorship Sessions */
    .sessions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 1.5rem;
      margin: 1.5rem 0;
    }
    
    .session-card {
      background: var(--off-white);
      border: 1px solid var(--light-taupe);
      border-radius: 12px;
      padding: 1.5rem;
      position: relative;
    }
    
    .session-status {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .session-upcoming { background: var(--warm-beige); color: var(--dark-brown); }
    .session-completed { background: var(--muted-rose); color: white; }
    .session-cancelled { background: #dc3545; color: white; }
    
    /* Announcements */
    .announcement-card {
      background: var(--off-white);
      border: 1px solid var(--light-taupe);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1rem 0;
      position: relative;
    }
    
    .announcement-priority {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .priority-high { background: #dc3545; color: white; }
    .priority-medium { background: #ffc107; color: var(--dark-brown); }
    .priority-low { background: var(--muted-rose); color: white; }
    
    /* Pricing Tables */
    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin: 1.5rem 0;
    }
    
    .pricing-card {
      background: var(--off-white);
      border: 1px solid var(--light-taupe);
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      position: relative;
    }
    
    .pricing-popular {
      border: 2px solid var(--gold-accent);
      transform: scale(1.05);
    }
    
    .popular-badge {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--gold-accent);
      color: var(--dark-brown);
      padding: 0.3rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    /* Calendar */
    .calendar-container {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin: 2rem 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
    }
    
    .calendar-day {
      padding: 1rem;
      text-align: center;
      border-radius: 8px;
      background: var(--off-white);
      cursor: pointer;
    }
    
    .calendar-day.has-session {
      background: var(--warm-beige);
      font-weight: 600;
    }
    
    .calendar-day.today {
      border: 2px solid var(--gold-accent);
    }
  </style>
</head>
<body>
  <header class="premium-header">
    <nav class="premium-nav">
      <a href="index.html" class="logo">Crown Trade Academy</a>
      <div style="display: flex; align-items: center; gap: 2rem;">
        <span style="color: var(--warm-beige); font-weight: 600;">Admin Dashboard</span>
        <ul class="nav-links">
          <li><a href="admin-dashboard.html" style="color: var(--warm-beige);">Dashboard</a></li>
          <li><a href="#" onclick="logout()">Logout</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <section class="premium-container" style="padding:2rem 0;">
    <!-- Dashboard Overview -->
    <div class="premium-card">
      <h1 style="color:var(--dark-brown); margin-bottom:2rem;">üìä Business Overview</h1>
      
      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="totalRevenue">KES 0</div>
          <div class="stat-label">Total Revenue</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="pendingApprovals">0</div>
          <div class="stat-label">Pending Approvals</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalUsers">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="conversionRate">0%</div>
          <div class="stat-label">Approval Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="activeSessions">0</div>
          <div class="stat-label">Active Sessions</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="mentorshipRevenue">KES 0</div>
          <div class="stat-label">Mentorship Revenue</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <div class="action-card" onclick="showTab('applications')">
          <h3>üë•</h3>
          <p>Manage Applications</p>
        </div>
        <div class="action-card" onclick="showTab('mentorship')">
          <h3>üéì</h3>
          <p>Mentorship</p>
        </div>
        <div class="action-card" onclick="showTab('analytics')">
          <h3>üìà</h3>
          <p>View Analytics</p>
        </div>
        <div class="action-card" onclick="showTab('settings')">
          <h3>‚öôÔ∏è</h3>
          <p>Program Settings</p>
        </div>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs">
      <button class="tab active" onclick="showTab('applications')">üìã Applications</button>
      <button class="tab" onclick="showTab('mentorship')">üéì Mentorship</button>
      <button class="tab" onclick="showTab('analytics')">üìà Analytics</button>
      <button class="tab" onclick="showTab('settings')">‚öôÔ∏è Settings</button>
      <button class="tab" onclick="showTab('withdrawals')">üí≥ Withdrawals</button>
    </div>

    <!-- Applications Tab -->
    <div id="applications-tab" class="tab-content active">
      <div class="premium-card">
        <h2 style="color:var(--dark-brown); margin-bottom:1rem;">Pending Applications</h2>
        <div id="applicationsList">
          <div style="text-align:center; color:var(--muted-rose); padding:3rem;">
            Loading applications...
          </div>
        </div>
      </div>
    </div>

    <!-- Mentorship Tab -->
    <div id="mentorship-tab" class="tab-content">
      <div class="premium-card">
        <h2 style="color:var(--dark-brown); margin-bottom:1rem;">üéì Mentorship Management</h2>
        
        <!-- Mentorship Sessions -->
        <div class="settings-form">
          <h3 style="color:var(--dark-brown); margin-bottom:1rem;">üìÖ Scheduled Sessions</h3>
          <button class="btn-premium" onclick="openSessionModal()" style="margin-bottom: 1.5rem;">+ Schedule New Session</button>
          
          <div class="sessions-grid" id="sessionsList">
            <div style="text-align:center; color:var(--muted-rose); padding:2rem; grid-column: 1/-1;">
              No sessions scheduled yet.
            </div>
          </div>
        </div>

        <!-- Mentorship Pricing -->
        <div class="settings-form">
          <h3 style="color:var(--dark-brown); margin-bottom:1rem;">üí∞ Mentorship Pricing</h3>
          <div class="pricing-grid">
            <div class="pricing-card">
              <h3 style="color:var(--dark-brown);">Basic Plan</h3>
              <div class="stat-number" id="basicPrice">KES 2,000</div>
              <p style="color:var(--muted-rose); margin:1rem 0;">4 sessions/month</p>
              <button class="btn-premium" onclick="editPricing('basic')">Edit Price</button>
            </div>
            
            <div class="pricing-card pricing-popular">
              <div class="popular-badge">Most Popular</div>
              <h3 style="color:var(--dark-brown);">Standard Plan</h3>
              <div class="stat-number" id="standardPrice">KES 4,500</div>
              <p style="color:var(--muted-rose); margin:1rem 0;">8 sessions/month</p>
              <button class="btn-premium" onclick="editPricing('standard')">Edit Price</button>
            </div>
            
            <div class="pricing-card">
              <h3 style="color:var(--dark-brown);">Premium Plan</h3>
              <div class="stat-number" id="premiumPrice">KES 8,000</div>
              <p style="color:var(--muted-rose); margin:1rem 0;">Unlimited sessions</p>
              <button class="btn-premium" onclick="editPricing('premium')">Edit Price</button>
            </div>
          </div>
        </div>

        <!-- Announcements -->
        <div class="settings-form">
          <h3 style="color:var(--dark-brown); margin-bottom:1rem;">üì¢ Announcements</h3>
          <button class="btn-premium" onclick="openAnnouncementModal()" style="margin-bottom: 1.5rem;">+ Create Announcement</button>
          
          <div id="announcementsList">
            <div class="announcement-card">
              <h4 style="color:var(--dark-brown); margin-bottom:0.5rem;">Welcome to Crown Trade Academy!</h4>
              <p style="color:var(--muted-rose); margin-bottom:1rem;">We're excited to announce our new mentorship program starting next month. Get ready for an amazing learning experience!</p>
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <small style="color:var(--muted-rose);">Posted: 2024-01-15</small>
                <span class="announcement-priority priority-high">High</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Analytics Tab -->
    <div id="analytics-tab" class="tab-content">
      <div class="premium-card">
        <h2 style="color:var(--dark-brown); margin-bottom:2rem;">Business Analytics</h2>
        
        <div class="chart-container">
          <h3 style="color:var(--dark-brown); margin-bottom:1rem;">Revenue Growth</h3>
          <canvas id="revenueChart"></canvas>
        </div>
        
        <div class="chart-container">
          <h3 style="color:var(--dark-brown); margin-bottom:1rem;">Application Status</h3>
          <canvas id="statusChart"></canvas>
        </div>
        
        <div class="chart-container">
          <h3 style="color:var(--dark-brown); margin-bottom:1rem;">Monthly Performance</h3>
          <canvas id="monthlyChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div id="settings-tab" class="tab-content">
      <div class="premium-card">
        <h2 style="color:var(--dark-brown); margin-bottom:2rem;">Program Settings</h2>
        
        <div class="settings-form">
          <h3 style="color:var(--dark-brown); margin-bottom:1rem;">üí∞ Payment Settings</h3>
          <div class="form-group">
            <label class="form-label">Registration Fee (KES)</label>
            <input type="number" id="registrationFee" class="form-control" value="500">
          </div>
          <div class="form-group">
            <label class="form-label">Referral Earnings (KES)</label>
            <input type="number" id="referralEarnings" class="form-control" value="300">
          </div>
          <div class="form-group">
            <label class="form-label">Minimum Withdrawal (KES)</label>
            <input type="number" id="minWithdrawal" class="form-control" value="100">
          </div>
          <button class="btn-premium" onclick="savePaymentSettings()">Save Payment Settings</button>
        </div>

        <div class="settings-form">
          <h3 style="color:var(--dark-brown); margin-bottom:1rem;">üìß Email Templates</h3>
          <div class="form-group">
            <label class="form-label">Approval Email Subject</label>
            <input type="text" id="approvalSubject" class="form-control" value="Welcome to Crown Trade Academy!">
          </div>
          <div class="form-group">
            <label class="form-label">Approval Email Message</label>
            <textarea id="approvalMessage" class="form-control" rows="4">Congratulations! Your application has been approved. You can now access your dashboard and start earning.</textarea>
          </div>
          <button class="btn-premium" onclick="saveEmailTemplates()">Save Email Templates</button>
        </div>

        <div class="settings-form">
          <h3 style="color:var(--dark-brown); margin-bottom:1rem;">üîí Admin Settings</h3>
          <div class="form-group">
            <label class="form-label">Change Admin Password</label>
            <input type="password" id="newPassword" class="form-control" placeholder="New password">
          </div>
          <button class="btn-premium" onclick="changeAdminPassword()">Change Password</button>
        </div>
      </div>
    </div>

    <!-- Withdrawals Tab -->
    <div id="withdrawals-tab" class="tab-content">
      <div class="premium-card">
        <h2 style="color:var(--dark-brown); margin-bottom:1rem;">üí≥ Withdrawal Requests</h2>
        <div id="withdrawalsList">
          <div style="text-align:center; color:var(--muted-rose); padding:3rem;">
            No withdrawal requests yet.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Session Modal -->
  <div id="sessionModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div style="background:white; padding:2rem; border-radius:12px; width:90%; max-width:500px;">
      <h3 style="color:var(--dark-brown); margin-bottom:1.5rem;">Schedule New Session</h3>
      <div class="form-group">
        <label class="form-label">Session Title</label>
        <input type="text" id="sessionTitle" class="form-control" placeholder="e.g., Forex Trading Basics">
      </div>
      <div class="form-group">
        <label class="form-label">Mentor</label>
        <select id="sessionMentor" class="form-control">
          <option value="john">John Doe (Forex Expert)</option>
          <option value="jane">Jane Smith (Crypto Specialist)</option>
          <option value="mike">Mike Johnson (Stocks Analyst)</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Date & Time</label>
        <input type="datetime-local" id="sessionDateTime" class="form-control">
      </div>
      <div class="form-group">
        <label class="form-label">Duration (minutes)</label>
        <input type="number" id="sessionDuration" class="form-control" value="60">
      </div>
      <div class="form-group">
        <label class="form-label">Max Participants</label>
        <input type="number" id="sessionMaxParticipants" class="form-control" value="20">
      </div>
      <div style="display:flex; gap:1rem; margin-top:1.5rem;">
        <button class="btn-premium" onclick="saveSession()" style="flex:1;">Schedule Session</button>
        <button class="btn-danger" onclick="closeSessionModal()" style="flex:1;">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Announcement Modal -->
  <div id="announcementModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div style="background:white; padding:2rem; border-radius:12px; width:90%; max-width:500px;">
      <h3 style="color:var(--dark-brown); margin-bottom:1.5rem;">Create Announcement</h3>
      <div class="form-group">
        <label class="form-label">Title</label>
        <input type="text" id="announcementTitle" class="form-control" placeholder="Announcement title">
      </div>
      <div class="form-group">
        <label class="form-label">Message</label>
        <textarea id="announcementMessage" class="form-control" rows="4" placeholder="Announcement message"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Priority</label>
        <select id="announcementPriority" class="form-control">
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>
      </div>
      <div style="display:flex; gap:1rem; margin-top:1.5rem;">
        <button class="btn-premium" onclick="saveAnnouncement()" style="flex:1;">Publish Announcement</button>
        <button class="btn-danger" onclick="closeAnnouncementModal()" style="flex:1;">Cancel</button>
      </div>
    </div>
  </div>

  <footer class="premium-footer">
    <div class="footer-content">
      <div>
        <h3>Admin Tools</h3>
        <p>Application Management</p>
        <p>Revenue Tracking</p>
      </div>
      <div>
        <h3>Quick Actions</h3>
        <p>Review Applications</p>
        <p>Update Settings</p>
      </div>
      <div>
        <h3>Support</h3>
        <p>Email: crowntradeacademy@gmail.com</p>
        <p>Admin Portal</p>
      </div>
    </div>
    <div style="text-align:center;margin-top:2rem;padding-top:2rem;border-top:1px solid var(--muted-rose);">
      <p>&copy; 2024 Crown Trade Academy. Enhanced Admin Dashboard</p>
    </div>
  </footer>

  <script>
    // Initialize Charts
    let revenueChart, statusChart, monthlyChart;

    // Mentorship data
    let mentorshipSessions = JSON.parse(localStorage.getItem('mentorship_sessions') || '[]');
    let mentorshipPricing = JSON.parse(localStorage.getItem('mentorship_pricing') || '{"basic":2000,"standard":4500,"premium":8000}');
    let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');

    // Simple admin authentication
    function checkAdminAuth() {
      const isAdmin = localStorage.getItem('admin_logged_in');
      if (!isAdmin) {
        const password = prompt('Enter admin password:');
        if (password === 'admin123') {
          localStorage.setItem('admin_logged_in', 'true');
        } else {
          alert('Invalid password');
          window.location.href = 'index.html';
        }
      }
    }

    function loadDashboardData() {
      const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');
      const settings = JSON.parse(localStorage.getItem('program_settings') || '{}');
      
      // Calculate stats
      const pendingApps = applications.filter(app => app.status === 'pending' || !app.status);
      const approvedApps = applications.filter(app => app.status === 'approved');
      const rejectedApps = applications.filter(app => app.status === 'rejected');
      
      const registrationFee = settings.registrationFee || 500;
      const referralEarnings = settings.referralEarnings || 300;
      
      const totalRevenue = approvedApps.length * registrationFee;
      const potentialRevenue = pendingApps.length * registrationFee;
      
      // Update stats
      document.getElementById('totalRevenue').textContent = `KES ${totalRevenue}`;
      document.getElementById('pendingApprovals').textContent = pendingApps.length;
      document.getElementById('totalUsers').textContent = approvedApps.length;
      document.getElementById('conversionRate').textContent = applications.length > 0 
        ? `${Math.round((approvedApps.length / applications.length) * 100)}%` 
        : '0%';
      
      // Mentorship stats
      const activeSessions = mentorshipSessions.filter(session => 
        new Date(session.dateTime) > new Date() && session.status !== 'cancelled'
      ).length;
      
      document.getElementById('activeSessions').textContent = activeSessions;
      document.getElementById('mentorshipRevenue').textContent = `KES ${mentorshipPricing.standard * 5}`; // Sample data
      
      // Load applications
      loadApplications();
      
      // Load mentorship data
      loadMentorshipData();
      
      // Load analytics
      loadAnalytics(applications, approvedApps, pendingApps, rejectedApps);
      
      // Load settings
      loadSettings(settings);
      
      // Load withdrawals
      loadWithdrawals();
    }

    function loadApplications() {
      const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');
      const pendingApps = applications.filter(app => app.status === 'pending' || !app.status);
      
      const applicationsList = document.getElementById('applicationsList');
      
      if (pendingApps.length === 0) {
        applicationsList.innerHTML = `
          <div style="text-align:center; color:var(--muted-rose); padding:3rem;">
            No pending applications at the moment.
          </div>
        `;
        return;
      }

      applicationsList.innerHTML = pendingApps.map(app => `
        <div class="application-card">
          <h3 style="color:var(--dark-brown); margin-bottom:0.5rem;">${app.fullName}</h3>
          <p style="color:var(--muted-rose); margin:0.25rem 0;">
            <strong>Email:</strong> ${app.email}
          </p>
          <p style="color:var(--muted-rose); margin:0.25rem 0;">
            <strong>Phone:</strong> ${app.phone}
          </p>
          <p style="color:var(--muted-rose); margin:0.25rem 0;">
            <strong>Applied:</strong> ${new Date(app.submittedAt).toLocaleDateString()}
          </p>
          <p style="margin:0.5rem 0;">
            <a href="#" onclick="viewPaymentProof('${app.id}')" style="color:var(--warm-beige); text-decoration:none;">
              üìé View Payment Proof
            </a>
          </p>
          <div class="action-buttons">
            <button class="btn-success" onclick="approveApplication('${app.id}')">
              Approve
            </button>
            <button class="btn-danger" onclick="rejectApplication('${app.id}')">
              Reject
            </button>
            <button class="btn-info" onclick="viewApplicationDetails('${app.id}')">
              Details
            </button>
          </div>
        </div>
      `).join('');
    }

    function loadMentorshipData() {
      // Load pricing
      document.getElementById('basicPrice').textContent = `KES ${mentorshipPricing.basic.toLocaleString()}`;
      document.getElementById('standardPrice').textContent = `KES ${mentorshipPricing.standard.toLocaleString()}`;
      document.getElementById('premiumPrice').textContent = `KES ${mentorshipPricing.premium.toLocaleString()}`;
      
      // Load sessions
      loadSessions();
      
      // Load announcements
      loadAnnouncements();
    }

    function loadSessions() {
      const sessionsList = document.getElementById('sessionsList');
      
      if (mentorshipSessions.length === 0) {
        sessionsList.innerHTML = `
          <div style="text-align:center; color:var(--muted-rose); padding:2rem; grid-column: 1/-1;">
            No sessions scheduled yet.
          </div>
        `;
        return;
      }

      sessionsList.innerHTML = mentorshipSessions.map((session, index) => {
        const sessionDate = new Date(session.dateTime);
        const now = new Date();
        const status = sessionDate > now ? 'upcoming' : 'completed';
        
        return `
          <div class="session-card">
            <span class="session-status session-${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>
            <h4 style="color:var(--dark-brown); margin-bottom:0.5rem;">${session.title}</h4>
            <p style="color:var(--muted-rose); margin:0.25rem 0;">
              <strong>Mentor:</strong> ${session.mentor}
            </p>
            <p style="color:var(--muted-rose); margin:0.25rem 0;">
              <strong>Date:</strong> ${sessionDate.toLocaleString()}
            </p>
            <p style="color:var(--muted-rose); margin:0.25rem 0;">
              <strong>Duration:</strong> ${session.duration} minutes
            </p>
            <p style="color:var(--muted-rose); margin:0.25rem 0;">
              <strong>Participants:</strong> 0/${session.maxParticipants}
            </p>
            <div class="action-buttons">
              <button class="btn-info" onclick="editSession(${index})">
                Edit
              </button>
              <button class="btn-warning" onclick="cancelSession(${index})" ${status !== 'upcoming' ? 'disabled' : ''}>
                Cancel
              </button>
              <button class="btn-danger" onclick="deleteSession(${index})">
                Delete
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function loadAnnouncements() {
      const announcementsList = document.getElementById('announcementsList');
      
      if (announcements.length === 0) {
        announcementsList.innerHTML = `
          <div style="text-align:center; color:var(--muted-rose); padding:2rem;">
            No announcements yet.
          </div>
        `;
        return;
      }

      announcementsList.innerHTML = announcements.map((announcement, index) => `
        <div class="announcement-card">
          <h4 style="color:var(--dark-brown); margin-bottom:0.5rem;">${announcement.title}</h4>
          <p style="color:var(--muted-rose); margin-bottom:1rem;">${announcement.message}</p>
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <small style="color:var(--muted-rose);">Posted: ${new Date(announcement.createdAt).toLocaleDateString()}</small>
            <span class="announcement-priority priority-${announcement.priority}">${announcement.priority.charAt(0).toUpperCase() + announcement.priority.slice(1)}</span>
          </div>
          <div class="action-buttons">
            <button class="btn-info" onclick="editAnnouncement(${index})">
              Edit
            </button>
            <button class="btn-danger" onclick="deleteAnnouncement(${index})">
              Delete
            </button>
          </div>
        </div>
      `).join('');
    }

    function loadAnalytics(applications, approvedApps, pendingApps, rejectedApps) {
      // Revenue Chart
      const revenueCtx = document.getElementById('revenueChart').getContext('2d');
      if (revenueChart) revenueChart.destroy();
      
      revenueChart = new Chart(revenueCtx, {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
          datasets: [{
            label: 'Revenue (KES)',
            data: [0, 0, 0, 0, 0, approvedApps.length * 500],
            borderColor: '#3A2D28',
            backgroundColor: 'rgba(58, 45, 40, 0.1)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Monthly Revenue Growth'
            }
          }
        }
      });

      // Status Chart
      const statusCtx = document.getElementById('statusChart').getContext('2d');
      if (statusChart) statusChart.destroy();
      
      statusChart = new Chart(statusCtx, {
        type: 'doughnut',
        data: {
          labels: ['Approved', 'Pending', 'Rejected'],
          datasets: [{
            data: [approvedApps.length, pendingApps.length, rejectedApps.length],
            backgroundColor: ['#28a745', '#ffc107', '#dc3545']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Monthly Chart
      const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
      if (monthlyChart) monthlyChart.destroy();
      
      monthlyChart = new Chart(monthlyCtx, {
        type: 'bar',
        data: {
          labels: ['Applications', 'Approvals', 'Revenue'],
          datasets: [{
            label: 'This Month',
            data: [applications.length, approvedApps.length, approvedApps.length * 500],
            backgroundColor: '#A48374'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Current Month Performance'
            }
          }
        }
      });
    }

    function loadSettings(settings) {
      document.getElementById('registrationFee').value = settings.registrationFee || 500;
      document.getElementById('referralEarnings').value = settings.referralEarnings || 300;
      document.getElementById('minWithdrawal').value = settings.minWithdrawal || 100;
      document.getElementById('approvalSubject').value = settings.approvalSubject || 'Welcome to Crown Trade Academy!';
      document.getElementById('approvalMessage').value = settings.approvalMessage || 'Congratulations! Your application has been approved.';
    }

    function loadWithdrawals() {
      const withdrawals = JSON.parse(localStorage.getItem('withdrawal_requests') || '[]');
      const withdrawalsList = document.getElementById('withdrawalsList');
      
      if (withdrawals.length === 0) {
        withdrawalsList.innerHTML = `
          <div style="text-align:center; color:var(--muted-rose); padding:3rem;">
            No withdrawal requests yet.
          </div>
        `;
        return;
      }

      withdrawalsList.innerHTML = withdrawals.map((withdrawal, index) => `
        <div class="application-card">
          <h3 style="color:var(--dark-brown); margin-bottom:0.5rem;">${withdrawal.userName}</h3>
          <p style="color:var(--muted-rose); margin:0.25rem 0;">
            <strong>Amount:</strong> KES ${withdrawal.amount}
          </p>
          <p style="color:var(--muted-rose); margin:0.25rem 0;">
            <strong>MPesa:</strong> ${withdrawal.phone}
          </p>
          <p style="color:var(--muted-rose); margin:0.25rem 0;">
            <strong>Requested:</strong> ${new Date(withdrawal.requestedAt).toLocaleDateString()}
          </p>
          <div class="action-buttons">
            <button class="btn-success" onclick="processWithdrawal(${index})">
              Process
            </button>
            <button class="btn-danger" onclick="rejectWithdrawal(${index})">
              Reject
            </button>
          </div>
        </div>
      `).join('');
    }

    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(`${tabName}-tab`).classList.add('active');
      event.target.classList.add('active');
    }

    // Session Management Functions
    function openSessionModal() {
      document.getElementById('sessionModal').style.display = 'flex';
    }

    function closeSessionModal() {
      document.getElementById('sessionModal').style.display = 'none';
      // Reset form
      document.getElementById('sessionTitle').value = '';
      document.getElementById('sessionDateTime').value = '';
      document.getElementById('sessionDuration').value = '60';
      document.getElementById('sessionMaxParticipants').value = '20';
    }

    function saveSession() {
      const title = document.getElementById('sessionTitle').value;
      const mentor = document.getElementById('sessionMentor').value;
      const dateTime = document.getElementById('sessionDateTime').value;
      const duration = document.getElementById('sessionDuration').value;
      const maxParticipants = document.getElementById('sessionMaxParticipants').value;
      
      if (!title || !dateTime) {
        alert('Please fill in all required fields');
        return;
      }
      
      const newSession = {
        id: Date.now().toString(),
        title,
        mentor: document.getElementById('sessionMentor').options[document.getElementById('sessionMentor').selectedIndex].text,
        dateTime,
        duration: parseInt(duration),
        maxParticipants: parseInt(maxParticipants),
        status: 'upcoming',
        createdAt: new Date().toISOString()
      };
      
      mentorshipSessions.push(newSession);
      localStorage.setItem('mentorship_sessions', JSON.stringify(mentorshipSessions));
      
      closeSessionModal();
      loadSessions();
      loadDashboardData();
      alert('Session scheduled successfully!');
    }

    function cancelSession(index) {
      if (confirm('Are you sure you want to cancel this session?')) {
        mentorshipSessions[index].status = 'cancelled';
        localStorage.setItem('mentorship_sessions', JSON.stringify(mentorshipSessions));
        loadSessions();
        alert('Session cancelled successfully!');
      }
    }

    function deleteSession(index) {
      if (confirm('Are you sure you want to delete this session?')) {
        mentorshipSessions.splice(index, 1);
        localStorage.setItem('mentorship_sessions', JSON.stringify(mentorshipSessions));
        loadSessions();
        alert('Session deleted successfully!');
      }
    }

    function editSession(index) {
      // For simplicity, we'll just allow deletion and recreation
      alert('To edit this session, please delete it and create a new one with the correct details.');
    }

    // Pricing Management Functions
    function editPricing(plan) {
      const currentPrice = mentorshipPricing[plan];
      const newPrice = prompt(`Enter new price for ${plan} plan (KES):`, currentPrice);
      
      if (newPrice && !isNaN(newPrice) && newPrice > 0) {
        mentorshipPricing[plan] = parseInt(newPrice);
        localStorage.setItem('mentorship_pricing', JSON.stringify(mentorshipPricing));
        loadMentorshipData();
        alert(`${plan.charAt(0).toUpperCase() + plan.slice(1)} plan price updated to KES ${newPrice}`);
      }
    }

    // Announcement Management Functions
    function openAnnouncementModal() {
      document.getElementById('announcementModal').style.display = 'flex';
    }

    function closeAnnouncementModal() {
      document.getElementById('announcementModal').style.display = 'none';
      // Reset form
      document.getElementById('announcementTitle').value = '';
      document.getElementById('announcementMessage').value = '';
      document.getElementById('announcementPriority').value = 'medium';
    }

    function saveAnnouncement() {
      const title = document.getElementById('announcementTitle').value;
      const message = document.getElementById('announcementMessage').value;
      const priority = document.getElementById('announcementPriority').value;
      
      if (!title || !message) {
        alert('Please fill in all required fields');
        return;
      }
      
      const newAnnouncement = {
        id: Date.now().toString(),
        title,
        message,
        priority,
        createdAt: new Date().toISOString()
      };
      
      announcements.push(newAnnouncement);
      localStorage.setItem('announcements', JSON.stringify(announcements));
      
      closeAnnouncementModal();
      loadAnnouncements();
      alert('Announcement published successfully!');
    }

    function editAnnouncement(index) {
      // For simplicity, we'll just allow deletion and recreation
      alert('To edit this announcement, please delete it and create a new one with the correct details.');
    }

    function deleteAnnouncement(index) {
      if (confirm('Are you sure you want to delete this announcement?')) {
        announcements.splice(index, 1);
        localStorage.setItem('announcements', JSON.stringify(announcements));
        loadAnnouncements();
        alert('Announcement deleted successfully!');
      }
    }

    // Existing functions from previous code
    function approveApplication(appId) {
      if (confirm('Approve this application?')) {
        const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');
        const appIndex = applications.findIndex(app => app.id === appId);
        
        if (appIndex !== -1) {
          applications[appIndex].status = 'approved';
          applications[appIndex].reviewedAt = new Date().toISOString();
          localStorage.setItem('referral_applications', JSON.stringify(applications));
          alert('Application approved!');
          loadDashboardData();
        }
      }
    }

    function rejectApplication(appId) {
      const reason = prompt('Enter rejection reason:');
      if (reason) {
        const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');
        const appIndex = applications.findIndex(app => app.id === appId);
        
        if (appIndex !== -1) {
          applications[appIndex].status = 'rejected';
          applications[appIndex].rejectionReason = reason;
          applications[appIndex].reviewedAt = new Date().toISOString();
          localStorage.setItem('referral_applications', JSON.stringify(applications));
          alert('Application rejected.');
          loadDashboardData();
        }
      }
    }

    function viewPaymentProof(appId) {
      const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');
      const app = applications.find(app => app.id === appId);
      
      if (app && app.proofBase64) {
        const newWindow = window.open();
        newWindow.document.write(`
          <html>
            <head><title>Payment Proof - ${app.fullName}</title></head>
            <body style="margin:0; padding:20px; text-align:center; background:#f5f5f5;">
              <h2>Payment Proof - ${app.fullName}</h2>
              <img src="${app.proofBase64}" style="max-width:100%; max-height:80vh; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.1);" />
              <br><br>
              <button onclick="window.close()" style="padding:10px 20px; background:#3A2D28; color:white; border:none; border-radius:5px; cursor:pointer;">
                Close
              </button>
            </body>
          </html>
        `);
      }
    }

    function viewApplicationDetails(appId) {
      const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');
      const app = applications.find(app => app.id === appId);
      
      if (app) {
        alert(`Application Details:\n\nName: ${app.fullName}\nEmail: ${app.email}\nPhone: ${app.phone}\nStatus: ${app.status || 'Pending'}\nSubmitted: ${new Date(app.submittedAt).toLocaleString()}`);
      }
    }

    function savePaymentSettings() {
      const settings = {
        registrationFee: parseInt(document.getElementById('registrationFee').value),
        referralEarnings: parseInt(document.getElementById('referralEarnings').value),
        minWithdrawal: parseInt(document.getElementById('minWithdrawal').value),
        approvalSubject: document.getElementById('approvalSubject').value,
        approvalMessage: document.getElementById('approvalMessage').value
      };
      
      localStorage.setItem('program_settings', JSON.stringify(settings));
      alert('Payment settings saved successfully!');
    }

    function saveEmailTemplates() {
      const settings = JSON.parse(localStorage.getItem('program_settings') || '{}');
      settings.approvalSubject = document.getElementById('approvalSubject').value;
      settings.approvalMessage = document.getElementById('approvalMessage').value;
      
      localStorage.setItem('program_settings', JSON.stringify(settings));
      alert('Email templates saved successfully!');
    }

    function changeAdminPassword() {
      const newPassword = document.getElementById('newPassword').value;
      if (newPassword && newPassword.length >= 6) {
        alert('Admin password changed successfully! New password: ' + newPassword);
        document.getElementById('newPassword').value = '';
      } else {
        alert('Password must be at least 6 characters long.');
      }
    }

    function processWithdrawal(index) {
      if (confirm('Mark this withdrawal as processed?')) {
        const withdrawals = JSON.parse(localStorage.getItem('withdrawal_requests') || '[]');
        withdrawals.splice(index, 1);
        localStorage.setItem('withdrawal_requests', JSON.stringify(withdrawals));
        alert('Withdrawal processed successfully!');
        loadWithdrawals();
      }
    }

    function rejectWithdrawal(index) {
      const reason = prompt('Enter rejection reason:');
      if (reason) {
        const withdrawals = JSON.parse(localStorage.getItem('withdrawal_requests') || '[]');
        withdrawals.splice(index, 1);
        localStorage.setItem('withdrawal_requests', JSON.stringify(withdrawals));
        alert('Withdrawal rejected.');
        loadWithdrawals();
      }
    }

    function exportData() {
      const applications = JSON.parse(localStorage.getItem('referral_applications') || '[]');
      const dataStr = JSON.stringify(applications, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'referral_applications.json';
      link.click();
      URL.revokeObjectURL(url);
    }

    function logout() {
      localStorage.removeItem('admin_logged_in');
      window.location.href = 'index.html';
    }

    // Initialize dashboard when page loads
    document.addEventListener('DOMContentLoaded', function() {
      checkAdminAuth();
      loadDashboardData();
      
      // Auto-refresh every 30 seconds
      setInterval(loadDashboardData, 30000);
    });
  </script>
</body>
</html>
